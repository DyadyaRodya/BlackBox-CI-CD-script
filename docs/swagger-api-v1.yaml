openapi: 3.0.0
info:
  title: 'BlackBox CI/CD API v.1.0'
  description: BlackBox XHR API spec
  version: 1.0.0-oas3
  contact:
    name: API Support
    email: vbliznetsov@ptsecurity.ru
components:

  securitySchemes:
    apiToken:
      type: apiKey
      in: header
      name: basic
      description: basic {apiToken}

  requestBodies:
    siteInputJSON:
      description: Only 'url' parameter is required
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              url:
                $ref: '#/components/schemas/XHRSiteURL'
              name:
                $ref: '#/components/schemas/XHRSiteName'
              verification:
                $ref: '#/components/schemas/XHRVerificationData'
              authenticationUUID:
                type: string
                description: Auth profile UUID
                example: 28b5a662-38a7-44f9-8119-ecd8d81ffa85
              profileUUID:
                type: string
                description: Scan profile UUID
                example: 28b5a662-38a7-44f9-8119-ecd8d81ffa85
              apiProfileUUID:
                type: string
                description: api profile UUID
                example: 241ab3ab-c56b-4aaf-9ff7-1714ed0e7e2b
              groupUUID:
                type: string
                description: group UUID
                example: 9dd61f0d-6a3e-4e7b-97fd-8a667a076379
    siteSettingsInputJSON:
      description: Site settings set model
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              url:
                $ref: '#/components/schemas/XHRSiteURL'
              name:
                $ref: '#/components/schemas/XHRSiteName'
              verification:
                $ref: '#/components/schemas/XHRVerificationData'
              profileUUID:
                type: string
                description: scan profile UUID
                example: 28b5a662-38a7-44f9-8119-ecd8d81ffa85
              authenticationUUID:
                type: string
                description: authentication UUID
                example: 28b5a662-38a7-44f9-8119-ecd8d81ffa85
              apiProfileUUID:
                type: string
                description: api profile UUID
                example: 241ab3ab-c56b-4aaf-9ff7-1714ed0e7e2b
    sharedDataInputJSON:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              ttl:
                $ref: '#/components/schemas/sharedLinkTtlEnum'
              emails:
                description: List of emails that have permission for reading the scan report
                type: array
                nullable: true
                items:
                  type: string
                  example: john@example.com
  parameters:
    siteUUID:
      in: path
      name: siteUUID
      schema:
        type: string
      required: true
      description: site's UUID
    scanID:
      in: path
      name: scanID
      schema:
        type: integer
      required: true
      description: Numerical ID of user's scan for previously specified site
    issueTypes:
      in: path
      name: issueTypes
      required: true
      schema:
        type: string
        enum:
          - issue
          - cve
          - error_page
    groupName:
      in: path
      name: groupName
      required: true
      schema:
        type: string
    severity:
      in: path
      name: severity
      required: true
      schema:
        type: string
        enum:
          - HIGH
          - MEDIUM
          - LOW
          - INFO
    csrfToken:
      in: header
      name: X-CSRFToken
      schema:
        type: string
        example: Mn1ws1YUnOG6FFQsmzyuRGwm4HuXY6yAYNaWzh9YhvMR9jrTGHcsQbF4h2RPVIaq
      description: Value of 'csrf_token' cookie
      required: true
    paginationLimit:
      in: query
      name: limit
      schema:
        type: integer
      required: false
      description: The numbers of items to return
      example: 10
    paginationPage:
      in: query
      name: page
      schema:
        type: integer
      required: false
      description: The number of current page
      example: 1

  schemas:
    baseResponse:
      type: object
      description: Base response for any request
      required:
        - ok
      properties:
        ok:
          type: boolean
          description: Indicates whether request was successful
          example: true
    errorResponse:
      allOf:
        - $ref: '#/components/schemas/baseResponse'
        - type: object
          description: Error occurred during processing of the request
          required:
            - error
            - ok
          properties:
            ok:
              example: false
            error:
              type: object
              required:
                - code
                - description
              properties:
                code:
                  type: string
                  description: 'Unique error code, for developers and debugging'
                  example: UNAUTHORIZED
                description:
                  type: string
                  description: Human-readable description of error
                  example: The request has not been applied because it lacks valid authentication credentials for the target resource.
                details:
                  type: object
                  description: Error-specific technical details
    siteNotFound:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              properties:
                code:
                  example: SITE_NOT_FOUND
                description:
                  example: The site not found
    scanNotFound:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
              properties:
                code:
                  example: SCAN_NOT_FOUND
    scanCreateLastScanProgress:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - description
              properties:
                description:
                  example: Can't start new scan, previous scan is not finished yet
    scanAuthCheckInProgress:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - description
              properties:
                description:
                  example: Can't start scan because authentication check has not finished yet
    scanStartTaskSend:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
                - description
              properties:
                code:
                  example: SCAN_START_ERROR
                description:
                  example: Cannot send task start scan
    scanStopTaskSend:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
                - description
              properties:
                code:
                  example: SCAN_STOP_ERROR
                description:
                  example: Cannot send task stop scan
    sitePermissionDenied:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              properties:
                code:
                  example: PERMISSION_DENIED
                description:
                  example: You have no permission to make this action with site
                details:
                  type: object
                  properties:
                    permissions:
                      type: string
                      example: CAN_EDIT_SITE_INFO
    siteLimitExceeded:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
              properties:
                code:
                  example: LIMIT_EXCEEDED
                details:
                  $ref: '#/components/schemas/roleAttributeDescription'
    siteExist:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
              properties:
                code:
                  example: SITE_EXIST_ERROR
    siteCannotSetUrl:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - description
              properties:
                description:
                  example: Url can't be changed after first scan
    siteCannotSetAuth:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
                - description
              properties:
                code:
                  example: SITE_CANNOT_SET_AUTH
                description:
                  example: Authentication cannot be set up while a scan or auth check is in progress
    scanCannotBeStopped:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - description
              properties:
                description:
                  example: Scan can be stopped only after start
    urlError:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
                - description
              properties:
                code:
                  example: URL_ERROR
                description:
                  type: string
                  example: Invalid url was passed
    siteUrlDeniedForAnyScans:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
                - description
              properties:
                code:
                  example: URL_DENIED_FOR_SCAN
                description:
                  type: string
                  example: This url is denied for all scan types
    licenseLimitExceeded:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
              properties:
                code:
                  example: LICENSE_LIMIT_EXCEEDED
                details:
                  $ref: '#/components/schemas/roleAttributeDescription'
    profileNotFound:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
              properties:
                code:
                  example: PROFILE_NOT_FOUND
    licenseInvalid:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
              properties:
                code:
                  example: LICENSE_ERROR
    fetchLicense:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
              properties:
                code:
                  example: FETCH_LICENSE_ERROR
    siteAuthSettingsNotFound:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
                - description
              properties:
                code:
                  example: SITE_AUTHENTICATION_NOT_FOUND
                description:
                  type: string
                  example: Site authentication is not found
    groupNotFound:
      allOf:
        - $ref: '#/components/schemas/errorResponse'
        - properties:
            ok:
              example: false
            error:
              required:
                - code
              properties:
                code:
                  example: GROUP_NOT_FOUND_ERROR
    roleAttributeDescription:
      type: object
      properties:
        limits:
          type: string
        permissions:
          type: string
    authenticationTypesEnum:
      type: string
      nullable: false
      description: Current authentication type selected by user for specified site
      enum:
        - HTTP_BASIC
        - HTML_FORM_BASED
        - DISABLED
      example: HTML_FORM_BASED
    verificationTypesEnum:
      type: string
      nullable: false
      description: Current verification type selected by user for specified site
      enum:
        - HTML_FILE
        - AGENT
      example: HTML_FILE
    ErrorReasonEnum:
      type: string
      nullable: true
      description: List of all possible scan errors
      enum:
        - API_SCHEMA_ERROR
        - TARGET_CONNECT_FAILED
        - TARGET_CONNECTION_TIMED_OUT
        - TARGET_PAGE_IS_STATIC
        - TARGET_DOWNLOAD_LIMIT_EXCEEDED
        - AGENT_IS_UNAVAILABLE
        - TARGET_REDIRECT_LIMIT
        - TARGET_DNS_RESOLUTION_FAILED
        - TARGET_HTTP_ERROR_404
        - TARGET_HTTP_ERROR_500
        - UNREACHABLE_REDIRECT
        - AUTH_CHECK_FAILED
        - UNKNOWN_ERROR
      example: null
    ScanStatusEnum:
      type: string
      nullable: false
      description: List of all possible scan states
      enum:
        - CREATED
        - SENT_START_TASK
        - STARTED
        - SENT_STOP_TASK
        - STOPPED
        - FINISHED
      example: FINISHED
    SeverityTypeEnum:
      type: string
      nullable: false
      description: List of all severity types for vulnerabilities
      enum:
        - HIGH
        - MEDIUM
        - LOW
        - INFO
      example: HIGH
    VulnChannelsEnum:
      type: string
      nullable: false
      description: Possible vulnerability channels
      enum:
        - PARAM
        - HEADER
        - URL_PATH
        - URL_QUERY
        - COOKIE
        - COMBO
      example: PARAM
    HTTPVerbsEnum:
      type: string
      nullable: false
      description: List of commonly used HTTP methods
      enum:
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
        - HEAD
        - OPTIONS
      example: POST
    AgentStatusEnum:
      type: string
      nullable: false
      description: List of all possible agent states
      enum:
        - ACTIVE
        - INACTIVE
        - DELETED
      example: ACTIVE
    AuthStatusEnum:
      type: string
      nullable: false
      description: List of possible authentication statuses
      enum:
        - NOT_CHECKED
        - CHECKING
        - SUCCESS
        - FAILED
    XHRSiteName:
      type: string
      nullable: true
      description: User-defined name of the site
      minLength: 1
      maxLength: 50
      example: Company ITSM portal
    XHRSiteURL:
      type: string
      description: URL of target site
      maxLength: 255
      example: 'https://itsm.example.com/'
    XHRSiteShort:
      type: object
      description: This object represents user's site
      properties:
        id:
          type: integer
          description: Unique ID of site (user scope)
          nullable: false
          example: 2
        verified:
          type: boolean
          nullable: false
          example: true
        name:
          type: string
          nullable: true
          description: User-defined name of site
          example: Company ITSM portal
        url:
          type: string
          nullable: false
          description: Target site URL. This is an entry point for all subsequent scans.
          example: 'https://itsm.example.com/'
        createdAt:
          type: string
          format: date-time
        lastScan:
          $ref: '#/components/schemas/XHRScanShort'
        profile:
          $ref: '#/components/schemas/XHRProfileShort'
        authentication:
          $ref: '#/components/schemas/XHRSiteAuthentication'
        apiProfile:
          $ref: '#/components/schemas/apiProfileShort'
        group:
          $ref: '#/components/schemas/XHRGroupShortInfo'
    XHRSiteInfo:
      type: object
      description: This object represents user's site
      properties:
        uuid:
          type: string
          description: Unique UUID of site
          nullable: false
          example: 6ae38ae8-8c20-4b79-a7ca-b11a90121f80
        verified:
          type: boolean
          nullable: false
          example: true
        name:
          type: string
          nullable: true
          description: User-defined name of site
          example: Company ITSM portal
        url:
          type: string
          nullable: false
          description: Target site URL. This is an entry point for all subsequent scans.
          example: 'https://itsm.example.com/'
        agent:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/XHRAgent'
        createdAt:
          type: string
          format: date-time
        lastScan:
          $ref: '#/components/schemas/XHRScanShort'
        requestFullScanStatus:
          type: string
          description: Contains request full scan status (field will be omitted on OnPremise)
          enum:
            - PENDING
            - ACCEPTED
            - REJECTED
        profile:
          $ref: '#/components/schemas/XHRProfileShort'
        authentication:
          $ref: '#/components/schemas/XHRSiteAuthentication'
        authStatus:
          $ref: '#/components/schemas/AuthStatusEnum'
        apiProfile:
          $ref: '#/components/schemas/apiProfileShort'
        group:
          $ref: '#/components/schemas/XHRGroupShortInfo'
    XHRVerificationData:
      type: object
      description: Data for site ownership verification
      properties:
        type:
          $ref: '#/components/schemas/verificationTypesEnum'
        htmlFile:
          type: object
          description: Data for HTML file verification type
          nullable: true
          properties:
            fileName:
              type: string
              description: Name of HTML verification file
              nullable: false
              example: 2f5efac781d59c86a5637dcaed73745a2c362c227fdf264ea1db5a58b1da39a6.html
            key:
              type: string
              description: Key stored in verification file
              nullable: false
              example: f85a3e4d99046f905687a076fa1b547b07268f81dedde930637a9b31e839fe23
        agent:
          type: object
          description: Data for agent verification type
          nullable: true
          properties:
            id:
              type: integer
              nullable: false
              description: ID of existing agent to use
              example: 2
    XHRSiteSettings:
      type: object
      description: This object represents current site settings
      properties:
        name:
          type: string
          description: User-defined name for site
          nullable: false
          example: Company ITSM portal
        url:
          type: string
          description: Target URL for scanning
          example: 'https://itsm.example.com/'
        verification:
          $ref: '#/components/schemas/XHRVerificationData'
        profile:
          $ref: '#/components/schemas/XHRProfileShort'
        authentication:
          $ref: '#/components/schemas/XHRSiteAuthentication'
        apiProfile:
          $ref: '#/components/schemas/apiProfileShort'
    XHRProfileShort:
      type: object
      description: This object represents a shoft profile custom params info
      properties:
        uuid:
          type: string
          example: ca73e0f5-d286-457c-9ec2-deca88a38ecc
        name:
          type: string
          example: extended fast
        type:
          type: string
          enum:
            - FULL
            - OPTIMAL
            - CUSTOM
          example: FULL
    XHRSiteAuthentication:
      type: object
      description: This object represents an authentication info for site
      required:
        - uuid
        - name
        - type
      properties:
        uuid:
          type: string
          example: ca73e0f5-d286-457c-9ec2-deca88a38ecc
        name:
          type: string
          example: admin
        type:
          $ref: '#/components/schemas/authProfileTypesEnum'
    apiProfileShort:
      type: object
      description: This object represents an APIProfile short info
      required:
        - uuid
        - name
        - countOfSchemas
      properties:
        uuid:
          type: string
          description: UUID of APIProfile
        name:
          type: string
          description: Name of APIProfile
        countOfSchemas:
          type: integer
          example: 1
          descriptions: Count of schemas
    ScanIntegralScore:
      type: integer
      description: Scan's integral score
      example: 6
      minimum: 1
      maximum: 10
    XHRGroupShortInfo:
      type: object
      description: This object represents a short group info
      required:
        - uuid
        - name
      properties:
        uuid:
          type: string
          example: 9dd61f0d-6a3e-4e7b-97fd-8a667a076379
        name:
          type: string
          example: devops
    authProfileTypesEnum:
      type: string
      enum:
        - USER
        - CHAIN
      example: USER
    XHRVulnChannel:
      type: object
      nullable: true
      description: Optional information about channel of injection
      properties:
        httpVerb:
          $ref: '#/components/schemas/HTTPVerbsEnum'
        type:
          $ref: '#/components/schemas/VulnChannelsEnum'
        parameterName:
          type: string
          nullable: false
          description: Parameter name
          example: id
    XHRScanShort:
      type: object
      description: This object represents a single scan
      properties:
        id:
          type: integer
          nullable: false
          example: 3
        authStatus:
          type: string
          description: Authentication status for scan
          enum:
            - NOT_CHECKED
            - CHECKING
            - SUCCESS
            - FAILED
        startedAt:
          type: string
          format: date-time
          description: Date-time when BBS actually started to scan specified target
        finishedAt:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/ScanStatusEnum'
        errorReason:
          $ref: '#/components/schemas/ErrorReasonEnum'
        progress:
          type: integer
          nullable: true
          example: 82
        vulnStats:
          $ref: '#/components/schemas/VulnerabilityStats'
        queuePosition:
          type: integer
          nullable: true
          example: 2
        score:
          $ref: '#/components/schemas/ScanIntegralScore'
        profile:
          $ref: '#/components/schemas/XHRProfileShort'
        authentication:
          $ref: '#/components/schemas/XHRSiteAuthentication'

    XHRVulnerabilityGroup:
      type: object
      description: This object represents a single found grouped vulnerability
      properties:
        issueType:
          $ref: '#/components/schemas/VulnerabilityIssueTypeEnum'
        categoryLocaleKey:
          type: string
          nullable: false
          description: Contains reference to current vuln category
          example: sensitive_data
        count:
          type: integer
          nullable: false
          description: Contains vulns count in current group
          example: 5
        groupTitle:
          type: string
          nullable: false
          description: Contains title for current group
          example: disclosure_email
        requestKey:
          type: string
          nullable: true
          description: Contains part of url for requesting all vulns in current group
          example: disclosure_email
        severity:
          $ref: '#/components/schemas/SeverityTypeEnum'
        vulnerability:
          type: object
          anyOf:
            - $ref: '#/components/schemas/XHRVulnerabilityIssueType'
            - $ref: '#/components/schemas/XHRVulnerabilityCVEType'
            - $ref: '#/components/schemas/XHRVulnerabilityCVEApprovedType'
            - $ref: '#/components/schemas/XHRVulnerabilityErrorPageType'
            - $ref: '#/components/schemas/XHRVulnerabilityAppsType'
    XHRAgent:
      type: object
      description: Agent entitiy for /agents
      properties:
        id:
          type: integer
          description: Unique agent id (user scope)
          example: 4
        name:
          type: string
          description: User-defined name of current agent
          example: Virtual linux machine in DMZ
        status:
          $ref: '#/components/schemas/AgentStatusEnum'
        createdAt:
          nullable: true
          type: string
          format: date-time
          description: Date-time of agent activation
        connectedAt:
          nullable: true
          type: string
          format: date-time
          description: Datetime of last agent connect action
        disconnectedAt:
          nullable: true
          type: string
          format: date-time
          description: Datetime of last agent disconnect action
    VulnerabilityStats:
      type: object
      properties:
        high:
          $ref: '#/components/schemas/VulnerabilityStatsItem'
        medium:
          $ref: '#/components/schemas/VulnerabilityStatsItem'
        low:
          $ref: '#/components/schemas/VulnerabilityStatsItem'
        info:
          $ref: '#/components/schemas/VulnerabilityStatsItem'
    VulnerabilityStatsItem:
      type: object
      properties:
        real:
          type: integer
          example: 2
        fixed:
          type: integer
          example: 1
    XHRMatchesArray:
      type: object
      description: 'An array of found objects, which are usually relate to Information Exposure'
      properties:
        foundData:
          type: array
          items:
            type: string
            example: 192.168.154.1
    XHRVulnerabilityIssueType:
      type: object
      description: This object represents a class of known vulnerabilities
      properties:
        id:
          type: integer
          nullable: false
          description: Vuln's id
          example: 2
        urlRel:
          type: string
          nullable: false
          description: Relative URL where vulnerability was found
          example: /ticket/create
        urlFull:
          type: string
          nullable: false
          description: Full URL where vulnerability was found
          example: 'https://itsm.example.com/ticket/create'
        channel:
          $ref: '#/components/schemas/XHRVulnChannel'
        requestRaw:
          type: string
          nullable: true
          description: Raw HTTP request
          example: |-
            POST /ticket/create HTTP/1.1
            Host: itsm.example.com
            content-type: application/x-www-form-urlencoded
            content-length: 66

            subject=%3C/textarea%3E%3Cscript%3Econfirm%2820836%29%3C/script%3E
        responseRaw:
          type: string
          nullable: true
          description: Raw HTTP response
          example: |-
            HTTP/1.1 200 OK
            Content-Length: 89
            Content-Type: text/html; charset=UTF-8

            <!DOCTYPE html><html><body><p>Invalid subject: </textarea><script>confirm(20836)</script>
        responseTime:
          type: number
          nullable: true
          description: Execution time in seconds
          example: 1.123
        matches:
          $ref: '#/components/schemas/XHRMatchesArray'
        vector:
          type: string
          nullable: true
          description: Optional string containing attack vector
          example: </textarea><script>confirm(20836)</script>
        severity:
          $ref: '#/components/schemas/SeverityTypeEnum'
        createdAt:
          type: string
          format: date-time
          description: Vulnerability detection Date-time

    XHRVulnerabilityCVEType:
      type: object
      description: This object represents a class of known vulnerabilities
      properties:
        id:
          type: integer
          nullable: false
          description: Vuln's id
          example: 2
        cveId:
          type: string
          nullable: false
          description: CVE Unique number
          example: CVE-2015-6665
        title:
          type: string
          nullable: false
          description: CVE's title
          example: CVE-2015-6665
        cvss:
          type: number
          nullable: false
          description: cvss value
          example: 3.5
        vector:
          type: string
          nullable: false
          description: cve vector
          example: '(AV:N/AC:M/Au:N/C:N/I:P/A:N/E:U/RL:OF/RC:C)'
    XHRVulnerabilityCVEApprovedType:
      type: object
      description: This object represents a class of known vulnerabilities
      properties:
        cveId:
          type: string
          nullable: false
          description: CVE Unique number
          example: CVE-2015-6665
        title:
          type: string
          nullable: false
          description: CVE's title
          example: CVE-2015-6665
        cvss:
          type: number
          nullable: false
          description: cvss value
          example: 3.5
        cvssVector:
          type: string
          nullable: false
          description: cve vector
          example: '(AV:N/AC:M/Au:N/C:N/I:P/A:N/E:U/RL:OF/RC:C)'
        requestRaw:
          type: string
          nullable: true
          description: Raw HTTP request
          example: HTTP/1.1 200 OK\r\n...</html>\n\n
        responseRaw:
          type: string
          nullable: true
          description: Raw HTTP response
          example: GET / HTTP/1.1\r\n...
        matches:
          type: array
          items:
            type: string
            example: Apache/2.4.43
    XHRVulnerabilityErrorPageType:
      type: object
      description: This object represents a class of known vulnerabilities
      properties:
        id:
          type: integer
          nullable: false
          description: Vuln's id
          example: 2
        code:
          type: integer
          nullable: false
          description: Page's status code
          example: 404
        url:
          type: string
          nullable: false
          description: Relative URL where vulnerability was found
          example: /ticket/create
        request:
          type: string
          nullable: true
          description: Raw HTTP request
          example: |-
            POST /ticket/create HTTP/1.1
            Host: itsm.example.com
            content-type: application/x-www-form-urlencoded
            content-length: 66

            subject=%3C/textarea%3E%3Cscript%3Econfirm%2820836%29%3C/script%3E
        response:
          type: string
          nullable: true
          description: Raw HTTP response
          example: |-
            HTTP/1.1 200 OK
            Content-Length: 89
            Content-Type: text/html; charset=UTF-8

            <!DOCTYPE html><html><body><p>Invalid subject: </textarea><script>confirm(20836)</script>

    XHRVulnerabilityAppsType:
      type: object
      description: This object represents a class of known vulnerabilities
      properties:
        apps:
          type: array
          items:
            $ref: '#/components/schemas/XHRVulnerabilityApp'

    XHRVulnerabilityApp:
      type: object
      properties:
        name:
          type: string
          nullable: false
          description: App's name
        version:
          type: string
          nullable: false
          description: App's version
        type:
          type: string
          nullable: false
          description: App's type

    XHRPagination:
      type: object
      properties:
        totalItems:
          type: integer
          nullable: false
          description: All items count
          example: 500
        hasPrevPage:
          type: boolean
          nullable: false
          description: If there is a previous page
          example: false
        hasNextPage:
          type: boolean
          nullable: false
          description: If there is a next page
          example: false
        pagesCount:
          type: integer
          nullable: false
          description: All pages count
          example: 1
        currentPage:
          type: integer
          nullable: false
          description: Current page number
          example: 1
    sharedLinkTtlEnum:
      type: integer
      nullable: true
      description: Shared link's time to live (in hours)
      enum:
        - 3
        - 24
        - 168
        - 720
        - 4320
      example: 24
    groupTypesEnum:
      type: string
      enum:
        - PRODUCT
        - USER
      example: USER
    roleNameConstantsEnum:
      type: string
      description: PT BlackBox roles
        - BASIC_API_TOKEN
        - GUEST
        - BASIC_UNVERIFIED_USER
        - BASIC_VERIFIED_USER
        - AUDITOR
        - OPERATOR
        - MODERATOR
        - MANAGER
        - ADMIN
      example: OPERATOR
    SharedLinkCreated:
      type: object
      description: This object represents a shared link created info
      properties:
        uuid:
          type: string
          nullable: false
          description: Sharer link's UUID
        ttl:
          $ref: '#/components/schemas/sharedLinkTtlEnum'
        emails:
          description: List of emails that has permission for reading the scan report
          type: array
          nullable: true
          items:
            type: string
            example: john@example.com
    VulnerabilityIssueTypeEnum:
      type: string
      nullable: false
      description: Vulnerability type
      enum:
        - issue
        - cve
        - error_page
        - apps
    XHRAuthProfileInfoShort:
      type: object
      description: This object represents a short auth profile info
      required:
        - uuid
        - name
      properties:
        uuid:
          type: string
          example: ca73e0f5-d286-457c-9ec2-deca88a38ecc
        name:
          type: string
          example: admin
    XHRAuthChainInfoShort:
      type: object
      description: This object represents a short auth chain info
      required:
        - name
        - uuid
      properties:
        name:
          type: string
          example: admin
        uuid:
          type: string
          example: ca73e0f5-d286-457c-9ec2-deca88a38ecc
    XHRGroupRoleShortInfo:
      type: object
      description: This object represents a group info with total users count
      required:
        - uuid
        - name
        - type
      properties:
        uuid:
          type: string
          example: 9dd61f0d-6a3e-4e7b-97fd-8a667a076379
        name:
          type: string
          example: devops
        type:
          $ref: '#/components/schemas/groupTypesEnum'
        role:
          $ref: '#/components/schemas/roleNameConstantsEnum'

security:
  - apiToken: [ ]

servers:
  - url: '{protocol}://bbs.ptsecurity.com/app/api/v1'
    description: bbs.ptsecurity.com server
    variables:
      protocol:
        enum:
          - http
          - https
        default: http
tags:
  - name: sites (general)
    description: 'CRUD for sites, state management, verification control'
  - name: sites (scans)
    description: scan results and related data
  - name: profiles
    description: set up new profile custom params, change/get/delete profile custom params
  - name: auth profiles
    description: 'Auth profiles endpoints'
  - name: auth chains
    description: 'Auth chains endpoints'
  - name: groups
    description: 'groups management'

paths:
  /sites:
    get:
      summary: Get (general) information about all user sites
      tags:
        - sites (general)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/XHRSiteShort'
                        nullable: false
  '/sites/{siteUUID}':
    get:
      summary: Get full information about specified site
      tags:
        - sites (general)
      parameters:
        - $ref: '#/components/parameters/siteUUID'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/XHRSiteInfo'
                    nullable: false
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/siteNotFound'
  /sites/add:
    post:
      summary: Create new site
      tags:
        - sites (general)
      parameters:
        - $ref: '#/components/parameters/csrfToken'
      requestBody:
        $ref: '#/components/requestBodies/siteInputJSON'
      responses:
        '201':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/XHRSiteInfo'
                    nullable: false
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/urlError'
                  - $ref: '#/components/schemas/siteAuthSettingsNotFound'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/sitePermissionDenied'
                  - $ref: '#/components/schemas/siteLimitExceeded'
                  - $ref: '#/components/schemas/siteExist'
                  - $ref: '#/components/schemas/siteUrlDeniedForAnyScans'
                  - $ref: '#/components/schemas/licenseLimitExceeded'
                  - $ref: '#/components/schemas/licenseInvalid'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/profileNotFound'
                  - $ref: '#/components/schemas/groupNotFound'
        '503':
          description: Service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/fetchLicense'
  '/sites/{siteUUID}/settings':
    get:
      summary: Get site settings
      tags:
        - sites (general)
      parameters:
        - $ref: '#/components/parameters/siteUUID'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/XHRSiteSettings'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/siteNotFound'
    post:
      summary: Change site settings
      tags:
        - sites (general)
      parameters:
        - $ref: '#/components/parameters/siteUUID'
        - $ref: '#/components/parameters/csrfToken'
      requestBody:
        $ref: '#/components/requestBodies/siteSettingsInputJSON'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/XHRSiteSettings'
        '400':
          description: Specified auth profile was not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/urlError'
                  - $ref: '#/components/schemas/siteAuthSettingsNotFound'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/sitePermissionDenied'
                  - $ref: '#/components/schemas/siteExist'
                  - $ref: '#/components/schemas/siteUrlDeniedForAnyScans'
                  - $ref: '#/components/schemas/siteCannotSetUrl'
                  - $ref: '#/components/schemas/siteCannotSetAuth'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/siteNotFound'
                  - $ref: '#/components/schemas/profileNotFound'
  '/sites/{siteUUID}/start':
    post:
      summary: Start scan for specified site
      tags:
        - sites (general)
      parameters:
        - $ref: '#/components/parameters/siteUUID'
        - $ref: '#/components/parameters/csrfToken'
      responses:
        '202':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/XHRScanShort'
                        nullable: false
        '400':
          description: Scan has already been started
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/errorResponse'
                  - properties:
                      ok:
                        example: false
                      error:
                        properties:
                          code:
                            example: SCAN_ALREADY_STARTED
                          description:
                            example: You have already started scan for this site. Click stop and the start to restart the scan.
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/sitePermissionDenied'
                  - $ref: '#/components/schemas/licenseLimitExceeded'
                  - $ref: '#/components/schemas/licenseInvalid'
                  - $ref: '#/components/schemas/siteLimitExceeded'
                  - $ref: '#/components/schemas/scanCreateLastScanProgress'
                  - $ref: '#/components/schemas/scanAuthCheckInProgress'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/siteNotFound'
                  - $ref: '#/components/schemas/scanNotFound'
        '503':
          description: Service unavailable
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/fetchLicense'
                  - $ref: '#/components/schemas/scanStartTaskSend'
  '/sites/{siteUUID}/stop':
    post:
      summary: Stop scan for specified site
      tags:
        - sites (general)
      parameters:
        - $ref: '#/components/parameters/siteUUID'
        - $ref: '#/components/parameters/csrfToken'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/baseResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/sitePermissionDenied'
                  - $ref: '#/components/schemas/scanCannotBeStopped'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/siteNotFound'
                  - $ref: '#/components/schemas/scanNotFound'
        '503':
          description: Service unavailable
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/fetchLicense'
                  - $ref: '#/components/schemas/scanStopTaskSend'
  '/sites/{siteUUID}/scans/{scanID}':
    get:
      summary: Get detailed information about specified scan
      tags:
        - sites (scans)
      parameters:
        - $ref: '#/components/parameters/siteUUID'
        - $ref: '#/components/parameters/scanID'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/XHRScanShort'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/sitePermissionDenied'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/siteNotFound'
                  - $ref: '#/components/schemas/scanNotFound'
  '/sites/{siteUUID}/scans/{scanID}/vulnerabilities':
    get:
      summary: Get grouped list of vulnerabilities for specified scan. Grouped by vuln's type and its severity.
      tags:
        - sites (scans)
      parameters:
        - $ref: '#/components/parameters/siteUUID'
        - $ref: '#/components/parameters/scanID'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/XHRVulnerabilityGroup'
                        nullable: false
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/sitePermissionDenied'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/siteNotFound'
                  - $ref: '#/components/schemas/scanNotFound'
  '/sites/{siteUUID}/scans/{scanID}/vulnerabilities/{issueTypes}/{groupName}/{severity}?limit=1&page=1':
    get:
      summary: Get all vulns in group
      description: Expand vuln's group. For create request URL use next
        issueType/requestKey/serverity from vulnerabilities endpoint's response
      tags:
        - sites (scans)
      parameters:
        - $ref: '#/components/parameters/paginationLimit'
        - $ref: '#/components/parameters/paginationPage'
        - $ref: '#/components/parameters/siteUUID'
        - $ref: '#/components/parameters/scanID'
        - $ref: '#/components/parameters/issueTypes'
        - $ref: '#/components/parameters/groupName'
        - $ref: '#/components/parameters/severity'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/XHRPagination'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  oneOf:
                                    - $ref: '#/components/schemas/XHRVulnerabilityIssueType'
                                    - $ref: '#/components/schemas/XHRVulnerabilityCVEType'
                                    - $ref: '#/components/schemas/XHRVulnerabilityErrorPageType'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/sitePermissionDenied'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/siteNotFound'
                  - $ref: '#/components/schemas/scanNotFound'
  '/sites/{siteUUID}/scans/{scanID}/shared':
    post:
      summary: 'Create shared link for current scan'
      tags:
        - sites (scans)
      parameters:
        - $ref: '#/components/parameters/siteUUID'
        - $ref: '#/components/parameters/scanID'
      requestBody:
        $ref: '#/components/requestBodies/sharedDataInputJSON'
      responses:
        '201':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SharedLinkCreated'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/sitePermissionDenied'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/siteNotFound'
                  - $ref: '#/components/schemas/scanNotFound'
    get:
      summary: 'Get shared links for current scan'
      tags:
        - sites (scans)
      parameters:
        - $ref: '#/components/parameters/siteUUID'
        - $ref: '#/components/parameters/scanID'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/SharedLinkCreated'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/siteNotFound'
                  - $ref: '#/components/schemas/scanNotFound'
  /profiles:
    get:
      summary: "Get list of available profile names for current user"
      tags:
        - profiles
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/XHRProfileShort'
                        nullable: false

  /authprofiles:
    get:
      summary: Get list of available auth profiles
      tags:
        - auth profiles
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/XHRAuthProfileInfoShort'
                        nullable: false

  /authchains:
    get:
      summary: Get list of available auth chains for current user
      tags:
        - auth chains
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/XHRAuthChainInfoShort'
  /groups:
    get:
      summary: Get list of groups that are available to current user
      tags:
        - groups
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/baseResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/XHRGroupRoleShortInfo'